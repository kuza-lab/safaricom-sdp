<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Safaricom SDP SDK by Phelix Juma</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Safaricom SDP SDK by Phelix Juma </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a PHP SDK wrapper for Safaricom SDP. Safaricom SDK allows PRSP content providers to integrate their systems with Safaricom's platform.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Included SDP Services</h1>
<ul>
<li>Token<ul>
<li>Get Token API : getting a token</li>
<li>Refresh Token API : getting a refresh token</li>
</ul>
</li>
<li>Subscription API<ul>
<li>Activate API : for subscribing a new user</li>
<li>Deactivate API : for deactivating a user from the subscription</li>
</ul>
</li>
<li>Premium SMS<ul>
<li>SendSMS API : Sending SMS to a user in a premium service</li>
</ul>
</li>
<li>Bulk SMS<ul>
<li>Bulk SMS API : Sending Bulk SMS to a set of users</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Requirements</h1>
<ul>
<li>PHP &gt;= 7.1</li>
<li>ext-json</li>
<li>ext-openssl</li>
<li>ext-mbstring</li>
<li>ext-openssl</li>
<li>ext-iconv</li>
<li>ext-curl</li>
<li>guzzlehttp/guzzle: "^7.1"</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<pre class="fragment">composer require phelix/safaricom-sdp
</pre><h1><a class="anchor" id="autotoc_md3"></a>
How To test</h1>
<p>To test the package, copy the file "LoadEnv.php.example" in src/tests directory to "LoadEnv.php" and fill in the configuration values required and then run the following command </p><pre class="fragment">phpunit test
</pre><p>#Documentation</p>
<p>The docs folder has the technical documentation of each of the classes,methods, properties, namespaces et al. In order for you to make references to know what a class does or what a function does or what each of the method parameters mean, then the docs have an elaborate description for each of them.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
1. Send Premium SMS</h2>
<p>This is used when sending a premium SMS service to a user; typically an MT message.</p>
<div class="fragment"><div class="line">&lt;?php </div>
<div class="line"> </div>
<div class="line">    use Phelix\SafaricomSDP\SDP;</div>
<div class="line">    use Phelix\SafaricomSDP\PremiumSMS;</div>
<div class="line">    use Phelix\SafaricomSDP\Exceptions\SDPException;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// We instantiate the SDP class; passing to it, the api username, api password and the cp id</span></div>
<div class="line">        $sdp = <span class="keyword">new</span> SDP($_ENV[<span class="stringliteral">&quot;SFC_SDP_API_USERNAME&quot;</span>], $_ENV[<span class="stringliteral">&quot;SFC_SDP_API_PASSWORD&quot;</span>], $_ENV[<span class="stringliteral">&quot;SFC_SDP_CP_ID&quot;</span>]);</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// By default, SDP will use the sandbox apis (test bed), call useLive() method to use production APIs</span></div>
<div class="line">        $sdp-&gt;useLive()-&gt;init();</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// We instantiate the premium SMS class and pass to it the SDP class</span></div>
<div class="line">        $premiumSMS = <span class="keyword">new</span> PremiumSMS($sdp);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// We send SMS</span></div>
<div class="line">        $requestId = <span class="stringliteral">&quot;1234&quot;</span>; <span class="comment">// Generate an id that you can use for tracking/logging purposes</span></div>
<div class="line">        $offerCode = <span class="stringliteral">&quot;23456&quot;</span>; <span class="comment">// The service for which the sms is being sent</span></div>
<div class="line">        $linkId = <span class="stringliteral">&quot;233348438989&quot;</span>; <span class="comment">// This ID is generated when a user requests for a service in SDP.</span></div>
<div class="line">        $phoneNumber = <span class="stringliteral">&quot;254712345678&quot;</span>; <span class="comment">// The phone number of the user to receive the message. Format is 2547...</span></div>
<div class="line">        $message = <span class="stringliteral">&quot;This is a test message&quot;</span>;</div>
<div class="line">        </div>
<div class="line">        $response = $premiumSMS-&gt;sendSMS($requestId, $offerCode, $linkId, $phoneNumber, $message);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// You can check the response and do logging as necessary. Ensure that the status is correctly logged to</span></div>
<div class="line">        <span class="comment">// help in tracking if the request was successful or failed</span></div>
<div class="line">        <span class="keywordflow">if</span> ($response[<span class="stringliteral">&#39;success&#39;</span>]) {</div>
<div class="line">            <span class="comment">// Request sent successfully to SDP. Should not be confused to mean the SMS has been successfully </span></div>
<div class="line">            <span class="comment">// delivered to the user</span></div>
<div class="line">            </div>
<div class="line">            <span class="comment">// We can now check the status of the sent message</span></div>
<div class="line">            <span class="keywordflow">if</span> (isset($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>])) {</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span> ($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;status&#39;</span>] == 1) {</div>
<div class="line">                    <span class="comment">// failed to send SMS</span></div>
<div class="line">                    print(<span class="stringliteral">&quot;SMS sending failed with status code&quot;</span> . $response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;statusCode&#39;</span>]. <span class="stringliteral">&quot;Error says: &quot;</span>. $response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// SMS sending a success. Confirm with the status code and the description and also log them for tracking purposes</span></div>
<div class="line">                    print($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// something wrong seems to have happened. No response param sent back. Handle this for tracking</span></div>
<div class="line">                print(<span class="stringliteral">&quot;Seems the response hasn&#39;t been sent. Best to assume it failed to send the sms&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// Failed to send the request. Could be network, authentication, authorization errors et al </span></div>
<div class="line">            print(<span class="stringliteral">&quot;Sending request failed with message&quot;</span> . $response[<span class="stringliteral">&#39;errorMessage&#39;</span>]);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    </div>
<div class="line">    } <span class="keywordflow">catch</span> (SDPException $ex) {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// You can do any error logging operations at this point. Exceptions here would most likely occur </span></div>
<div class="line">        <span class="comment">// at the point of token generation</span></div>
<div class="line">        </div>
<div class="line">        print $ex-&gt;getMessage();</div>
<div class="line">        </div>
<div class="line">    }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
1. Activate a Subscription</h2>
<p>This is used when subscribing a new user to a service</p>
<div class="fragment"><div class="line">&lt;?php </div>
<div class="line"> </div>
<div class="line">    use Phelix\SafaricomSDP\SDP;</div>
<div class="line">    use Phelix\SafaricomSDP\Subscription;</div>
<div class="line">    use Phelix\SafaricomSDP\Exceptions\SDPException;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// We instantiate the SDP class; passing to it, the api username, api password and the cp id</span></div>
<div class="line">        $sdp = <span class="keyword">new</span> SDP($_ENV[<span class="stringliteral">&quot;SFC_SDP_API_USERNAME&quot;</span>], $_ENV[<span class="stringliteral">&quot;SFC_SDP_API_PASSWORD&quot;</span>], $_ENV[<span class="stringliteral">&quot;SFC_SDP_CP_ID&quot;</span>]);</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// By default, SDP will use the sandbox apis (test bed), call useLive() method to use production APIs</span></div>
<div class="line">        $sdp-&gt;useLive()-&gt;init();</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// We instantiate the premium SMS class and pass to it the SDP class</span></div>
<div class="line">        $subscription = <span class="keyword">new</span> Subscription($sdp);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// We send SMS</span></div>
<div class="line">        $requestId = <span class="stringliteral">&quot;1234&quot;</span>; <span class="comment">// Generate an id that you can use for tracking/logging purposes</span></div>
<div class="line">        $offerCode = <span class="stringliteral">&quot;23456&quot;</span>; <span class="comment">// The service for which the sms is being sent</span></div>
<div class="line">        $phoneNumber = <span class="stringliteral">&quot;254712345678&quot;</span>; <span class="comment">// The phone number of the user to receive the message. Format is 2547...</span></div>
<div class="line">        </div>
<div class="line">        $response = $subscription-&gt;activateSubscription($requestId, $offerCode, $phoneNumber);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// You can check the response and do logging as necessary. Ensure that the status is correctly logged to</span></div>
<div class="line">        <span class="comment">// help in tracking if the request was successful or failed</span></div>
<div class="line">        <span class="keywordflow">if</span> ($response[<span class="stringliteral">&#39;success&#39;</span>]) {</div>
<div class="line">            <span class="comment">// Request sent successfully to SDP. Should not be confused to mean the activation has been successfully done </span></div>
<div class="line">            </div>
<div class="line">            <span class="comment">// We can now check the status of the sent message</span></div>
<div class="line">            <span class="keywordflow">if</span> (isset($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>])) {</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span> ($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;status&#39;</span>] == 1) {</div>
<div class="line">                    <span class="comment">// failed to activate subscription</span></div>
<div class="line">                    print(<span class="stringliteral">&quot;Activation failed&quot;</span> . $response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;statusCode&#39;</span>]. <span class="stringliteral">&quot;Error says: &quot;</span>. $response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// Activation a success. Confirm with the status code and the description and also log them for tracking purposes</span></div>
<div class="line">                    <span class="comment">// Not advisable to assume that this is a success. Always confirm with status code.</span></div>
<div class="line">                    print($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// something wrong seems to have happened. No response param sent back. Handle this for tracking</span></div>
<div class="line">                print(<span class="stringliteral">&quot;Seems the response hasn&#39;t been sent. Best to assume it failed to activate the user&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// Failed to send the request. Could be network, authentication, authorization errors et al </span></div>
<div class="line">            print(<span class="stringliteral">&quot;Failed to send the request&quot;</span> . $response[<span class="stringliteral">&#39;errorMessage&#39;</span>]);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    </div>
<div class="line">    } <span class="keywordflow">catch</span> (SDPException $ex) {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// You can do any error logging operations at this point. Exceptions here would most likely occur </span></div>
<div class="line">        <span class="comment">// at the point of token generation</span></div>
<div class="line">        </div>
<div class="line">        print $ex-&gt;getMessage();</div>
<div class="line">        </div>
<div class="line">    }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
3. Deactivate a Subscription</h2>
<p>This is used when unsubscribing a user from a service</p>
<div class="fragment"><div class="line">&lt;?php </div>
<div class="line"> </div>
<div class="line">    use Phelix\SafaricomSDP\SDP;</div>
<div class="line">    use Phelix\SafaricomSDP\Subscription;</div>
<div class="line">    use Phelix\SafaricomSDP\Exceptions\SDPException;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// We instantiate the SDP class; passing to it, the api username, api password and the cp id</span></div>
<div class="line">        $sdp = <span class="keyword">new</span> SDP($_ENV[<span class="stringliteral">&quot;SFC_SDP_API_USERNAME&quot;</span>], $_ENV[<span class="stringliteral">&quot;SFC_SDP_API_PASSWORD&quot;</span>], $_ENV[<span class="stringliteral">&quot;SFC_SDP_CP_ID&quot;</span>]);</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// By default, SDP will use the sandbox apis (test bed), call useLive() method to use production APIs</span></div>
<div class="line">        $sdp-&gt;useLive()-&gt;init();</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// We instantiate the premium SMS class and pass to it the SDP class</span></div>
<div class="line">        $subscription = <span class="keyword">new</span> Subscription($sdp);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// We send SMS</span></div>
<div class="line">        $requestId = <span class="stringliteral">&quot;1234&quot;</span>; <span class="comment">// Generate an id that you can use for tracking/logging purposes</span></div>
<div class="line">        $offerCode = <span class="stringliteral">&quot;23456&quot;</span>; <span class="comment">// The service for which the sms is being sent</span></div>
<div class="line">        $phoneNumber = <span class="stringliteral">&quot;254712345678&quot;</span>; <span class="comment">// The phone number of the user to receive the message. Format is 2547...</span></div>
<div class="line">        </div>
<div class="line">        $response = $subscription-&gt;deactivateSubscription($requestId, $offerCode, $phoneNumber);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// You can check the response and do logging as necessary. Ensure that the status is correctly logged to</span></div>
<div class="line">        <span class="comment">// help in tracking if the request was successful or failed</span></div>
<div class="line">        <span class="keywordflow">if</span> ($response[<span class="stringliteral">&#39;success&#39;</span>]) {</div>
<div class="line">            <span class="comment">// Request sent successfully to SDP. Should not be confused to mean the deactivation has been successfully done </span></div>
<div class="line">            </div>
<div class="line">            <span class="comment">// We can now check the status of the sent message</span></div>
<div class="line">            <span class="keywordflow">if</span> (isset($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>])) {</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span> ($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;status&#39;</span>] == 1) {</div>
<div class="line">                    <span class="comment">// failed to activate subscription</span></div>
<div class="line">                    print(<span class="stringliteral">&quot;Activation failed&quot;</span> . $response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;statusCode&#39;</span>]. <span class="stringliteral">&quot;Error says: &quot;</span>. $response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// Activation a success. Confirm with the status code and the description and also log them for tracking purposes</span></div>
<div class="line">                    <span class="comment">// Not advisable to assume that this is a success. Always confirm with status code.</span></div>
<div class="line">                    print($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;responseParam&#39;</span>][<span class="stringliteral">&#39;description&#39;</span>]);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// something wrong seems to have happened. No response param sent back. Handle this for tracking</span></div>
<div class="line">                print(<span class="stringliteral">&quot;Seems the response hasn&#39;t been sent. Best to assume it failed to deactivate the user&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// Failed to send the request. Could be network, authentication, authorization errors et al </span></div>
<div class="line">            print(<span class="stringliteral">&quot;Failed to send the request&quot;</span> . $response[<span class="stringliteral">&#39;errorMessage&#39;</span>]);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    </div>
<div class="line">    } <span class="keywordflow">catch</span> (SDPException $ex) {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// You can do any error logging operations at this point. Exceptions here would most likely occur </span></div>
<div class="line">        <span class="comment">// at the point of token generation</span></div>
<div class="line">        </div>
<div class="line">        print $ex-&gt;getMessage();</div>
<div class="line">        </div>
<div class="line">    }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
4. Send Bulk SMS</h2>
<p>This is used when sending bulk sms to users</p>
<div class="fragment"><div class="line">&lt;?php </div>
<div class="line"> </div>
<div class="line">    use Phelix\SafaricomSDP\SDP;</div>
<div class="line">    use Phelix\SafaricomSDP\BulkSMS;</div>
<div class="line">    use Phelix\SafaricomSDP\Exceptions\SDPException;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// We instantiate the SDP class; passing to it, the api username, api password and the cp id</span></div>
<div class="line">        $sdp = <span class="keyword">new</span> SDP($_ENV[<span class="stringliteral">&quot;SFC_SDP_API_USERNAME&quot;</span>], $_ENV[<span class="stringliteral">&quot;SFC_SDP_API_PASSWORD&quot;</span>], $_ENV[<span class="stringliteral">&quot;SFC_SDP_CP_ID&quot;</span>]);</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// By default, SDP will use the sandbox apis (test bed), call useLive() method to use production APIs</span></div>
<div class="line">        $sdp-&gt;useLive()-&gt;init();</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// We instantiate the premium SMS class and pass to it the SDP class</span></div>
<div class="line">        $bulkSMS = <span class="keyword">new</span> BulkSMS($sdp);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// We send SMS</span></div>
<div class="line">        $requestId = <span class="stringliteral">&quot;1234&quot;</span>; <span class="comment">// Generate an id that you can use for tracking/logging purposes</span></div>
<div class="line">        $username = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Username allocated by the SDP to the partner after successful registration.</span></div>
<div class="line">        $packageId = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// The id of the campaign package as issued upon successful registration</span></div>
<div class="line">        $originatingAddress = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Originating address assigned to partner after successful registration.</span></div>
<div class="line">        $recipients = [723345678, 789923456, 79098734];</div>
<div class="line">        $message = <span class="stringliteral">&quot;This is a bulk sms&quot;</span>;</div>
<div class="line">        $callback = <span class="stringliteral">&quot;https://your_call_back_url.com/callback&quot;</span>;</div>
<div class="line">        </div>
<div class="line">        $response = $bulkSMS-&gt;sendSMS($requestId, $username, $packageId, $originatingAddress, $recipients, $message, $callback);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// You can check the response and do logging as necessary. Ensure that the status is correctly logged to</span></div>
<div class="line">        <span class="comment">// help in tracking if the request was successful or failed</span></div>
<div class="line">        <span class="keywordflow">if</span> ($response[<span class="stringliteral">&#39;success&#39;</span>]) {</div>
<div class="line">            <span class="comment">// Request sent successfully to SDP. Should not be confused to mean the bulk has been successfully done </span></div>
<div class="line">            </div>
<div class="line">            <span class="comment">// We can now check the status of the sent message</span></div>
<div class="line">            <span class="keywordflow">if</span> (isset($response[<span class="stringliteral">&#39;data&#39;</span>])) {</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span> ($response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;status&#39;</span>] == <span class="stringliteral">&quot;SUCCESS&quot;</span>) {</div>
<div class="line">                    <span class="comment">// Bulk SMS successfully dispatched. This does not mean sent to users; this can only be confirmed from the callback</span></div>
<div class="line">                    print(<span class="stringliteral">&quot;Messages successfully dispatched to SDP&quot;</span>);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// Error dispatching bulk SMS to SDP/Safaricom</span></div>
<div class="line">                    print(<span class="stringliteral">&quot;Failed to response code &quot;</span>. $response[<span class="stringliteral">&#39;data&#39;</span>][<span class="stringliteral">&#39;statusCode&#39;</span>]);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// something wrong seems to have happened. No response param sent back. Handle this for tracking</span></div>
<div class="line">                print(<span class="stringliteral">&quot;Seems the response hasn&#39;t been sent. Best to assume it failed to dispatch the bulk SMS to the users&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// Failed to send the request. Could be network, authentication, authorization errors et al </span></div>
<div class="line">            print(<span class="stringliteral">&quot;Failed to send request. Error says &quot;</span> . $response[<span class="stringliteral">&#39;errorMessage&#39;</span>]);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    </div>
<div class="line">    } <span class="keywordflow">catch</span> (SDPException $ex) {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// You can do any error logging operations at this point. Exceptions here would most likely occur </span></div>
<div class="line">        <span class="comment">// at the point of token generation</span></div>
<div class="line">        </div>
<div class="line">        print $ex-&gt;getMessage();</div>
<div class="line">        </div>
<div class="line">    }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
5. Bulk SMS Callback</h2>
<p>This is used when getting and handling bulk sms callback</p>
<div class="fragment"><div class="line">&lt;?php </div>
<div class="line"> </div>
<div class="line">    use Phelix\SafaricomSDP\Utils;</div>
<div class="line"> </div>
<div class="line">    $responseData = Utils::getCallback();</div>
<div class="line">            </div>
<div class="line">    <span class="comment">// get the request id. At this point, you can query your database to get the request so as to be able to update its status</span></div>
<div class="line">    $requestId = isset($responseData[<span class="stringliteral">&#39;requestId&#39;</span>]) ? $responseData[<span class="stringliteral">&#39;requestId&#39;</span>] : <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// check the delivery status</span></div>
<div class="line">    $deliveryStatus = Utils::getCallbackResponseDataItemValue($responseData[<span class="stringliteral">&#39;requestParam&#39;</span>][<span class="stringliteral">&#39;data&#39;</span>], <span class="stringliteral">&quot;deliveryStatus&quot;</span>);</div>
<div class="line">    $description = Utils::getCallbackResponseDataItemValue($responseData[<span class="stringliteral">&#39;requestParam&#39;</span>][<span class="stringliteral">&#39;data&#39;</span>], <span class="stringliteral">&quot;Description&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> ($deliveryStatus != 0) {</div>
<div class="line">        print(<span class="stringliteral">&quot;Delivery failed. Fail reason &quot;</span> . $description);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Delivery successful. Update the request and mark it as delivered</span></div>
<div class="line">        print(<span class="stringliteral">&quot;Message delivered&quot;</span>);</div>
<div class="line">    }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
6. Sample Response Examples</h2>
<h4><a class="anchor" id="autotoc_md10"></a>
i.Get Token API</h4>
<pre class="fragment">```php
{
"msg": "You have been Authenticated to access this protected API System.",
"token": "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ0ZXN0dXNlciIsImF1ZCI6IkFDQ0VTUyIsInNjb3BlcyI6IkFETUlOIi wiaXNzIjoiaHR0cDovL3NpeGRlZS5jb20iLCJpYXQiOjE1Njk0OTc1MjksImV4cCI6MTU3NDI5NzUyOX0.- u2Db8OSDhtITMoFqIZYTgs6u4Ib_voynEA6k7ZwiqJqaPQ1_CnUaARxeaoSpC_BC-78_k- rzOr3v2Jdb9_KaA",
"refreshToken": "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ0ZXN0dXNlciIsImF1ZCI6IlJFRlJFU0giLCJzY29wZXMiOiJBRE1J TiIsImlzcyI6Imh0dHA6Ly9zaXhkZWUuY29tIiwianRpIjoiZGIzOTk4OTYtMTU0ZS00ZDFjLTg1NmYtNTUy MDE2MDU3MDVkIiwiaWF0IjoxNTY5NDk3NTI5LCJleHAiOjE1ODAyOTc1Mjl9.uD7fvaMigBI0a2GC00fte qtTx79Elil1CFxRtXz5CTs1qRhJYUVsD0ZjF5Q13J9btY-5ppuzFDqDFkFfUpZAMw"
}
``` 
</pre><h4><a class="anchor" id="autotoc_md11"></a>
ii.Refresh Token API</h4>
<pre class="fragment">    ```php
    {
    "token": "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ0ZXN0dXNlciIsImF1ZCI6IkFDQ0VTUyIsInNjb3BlcyI6IkFETUlOI iwiaXNzIjoiaHR0cDovL3NpeGRlZS5jb20iLCJpYXQiOjE1Njk0OTc3NTgsImV4cCI6MTU3NDI5Nzc1OH 0.okOMCxGRFd1qt2OLVFFF4eDJ6aPZpLDhkNLA9STVMt9zH7fiMYaNz0S56_tJSXAtxYYq02PoQyG O4WBs716tCg"
    }
    ```
</pre> <h4><a class="anchor" id="autotoc_md12"></a>
iii.Activate Subscription API</h4>
<pre class="fragment">    ```php
     {
        "requestId":"17",
        "responseId":"cp2910183038077087336761",
        "responseTimeStamp":"20191104092806",
        "channel":"SMS",
        "operation":"ACTIVATE",
        "requestParam":{
           "data":[
              {
                 "name":"OfferCode",
                 "value":"350032100559"
              },
              {
                 "name":"Msisdn",
                 "value":"795421629"
              },
              {
                 "name":"Language",
                 "value":"1"
              },
              {
                 "name":"CpId",
                 "value":"321"
              }
           ]
        },
        "responseParam":{
           "status":"0",
           "statusCode":"0816",
           "description":"Thank you, your activation of service 5000_Promotional is not processed."
        }
     }
    ```
</pre> <h4><a class="anchor" id="autotoc_md13"></a>
iv.Deactivate Subscription API</h4>
<pre class="fragment">    ```php
     {
        "requestId":"17",
        "responseId":"10189519962937756186",
        "responseTimeStamp":"20190924161246",
        "channel":"3",
        "sourceAddress":"224.223.10.27",
        "operation":"DEACTIVATE",
        "requestParam":{
           "data":[
              {
                 "name":"OfferCode",
                 "value":"1001"
              },
              {
                 "name":"Msisdn",
                 "value":"716848648"
              },
              {
                 "value":"10"
              }
           ]
        },
        "responseParam":{
           "status":"0",
           "statusCode":"302",
           "description":"Dear subscriber,You have cancelled your subscription to LOCAL CHANNEL Pack. Thank you for using our service."
        }
     }
    ```
</pre> <h4><a class="anchor" id="autotoc_md14"></a>
v.Send SMS</h4>
<pre class="fragment">    ```php
     {
        "requestId":"17",
        "responseId":"10189519182688287792",
        "responseTimeStamp":"20190924155948",
        "channel":"3",
        "sourceAddress":"224.223.10.27",
        "operation":"SendSMS",
        "requestParam":{
           "data":[
              {
                 "name":"LinkId",
                 "value":"00010310189519161781865526"
              },
              {
                 "name":"Msisdn",
                 "value":"254795421629"
              },
              {
                 "value":"Thank You for Ondemand Subscription SAFRI TEST TUN Subscption test Send sms"
              },
              {
                 "name":"OfferCode",
                 "value":"1003"
              },
              {
                 "value":"10"
              }
           ]
        },
        "responseParam":{
           "status":"1",
           "statusCode":"782",
           "description":"Send SMS Failed"
        }
     }
    ```
</pre><h4><a class="anchor" id="autotoc_md15"></a>
vi.Bulk SMS</h4>
<pre class="fragment">    ```php
     {
        "keyword":"Bulk",
        "status":"SUCCESS",
        "statusCode":"SC0000"
     }
    ```
</pre><h4><a class="anchor" id="autotoc_md16"></a>
vii. Bulk SMS Callback</h4>
<pre class="fragment">    ```php
     {
        "requestId":"",
        "requestTimeStamp":"",
        "channel":"",
        "operation" :"",
        "traceID": "".
        "requestParam": {
            "data" : [
                {
                    "name" : "Msisdn",
                    "value":""
                },
                {
                    "name" : "CpId",
                    "value":""
                },
                {
                    "name" : "CorrelatorId",
                    "value":""
                },
                {
                    "name" : "Description",
                    "value":""
                },
                {
                    "name" : "DeliveryStatus",
                    "value":""
                },
                {
                    "name" : "Type",
                    "value":""
                },
                {
                    "name" : "CampaignId",
                    "value":""
                }

            ]
        }
     }
    ```
</pre><h1><a class="anchor" id="autotoc_md17"></a>
Credits</h1>
<ul>
<li>Phelix Juma from Kuza Lab Ltd (<a href="#" onclick="location.href='mai'+'lto:'+'jum'+'ap'+'hel'+'ix'+'@ku'+'za'+'lab'+'.c'+'om'; return false;">jumap<span style="display: none;">.nosp@m.</span>heli<span style="display: none;">.nosp@m.</span>x@kuz<span style="display: none;">.nosp@m.</span>alab<span style="display: none;">.nosp@m.</span>.com</a>) </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
